var RMA={};RMA.returned=function(){var tpl=$('#tr-tpl').html();var div=$('#div-operation');var btn=$('#btn-submit');var tb=$('#tb-goods_list');$('.btn-return').click(function(){div.show();btn.attr('disabled',false);var id=this.id.substr(4);var el=$('#tr-'+id);var goods_sn=$('#td-sn-'+id).text();var goods_title=$('#a-title-'+id).text();if(el.length==0){var _tpl=tpl.replace('@sn',goods_sn);$('<tr id="tr-'+id+'">'+_tpl+'</tr>').appendTo(tb).find('.btn-return_delete').click(function(){$(this).parents('tr:first').remove();if($('tr',tb).length==2){div.hide();btn.attr('disabled',true)}}).end().find('.txt-return_num').attr('name','num[]').keyup(function(){var max=parseInt($('#td-num-'+id).text());this.value=this.value.replace(/[^\d]/g,'');this.value=this.value>max?max:this.value;this.value=this.value<1?1:this.value}).end().find('select').attr('name','reason[]').end().find('textarea').attr('name','desc[]').end().find('.goods_sn').attr({'name':'goods_sn[]','value':goods_sn}).end().find('.goods_title').attr({'name':'goods_title[]','value':goods_title})}return false});return this};RMA.list=function(){var el=$('#txt-keyword');var defaultValue='RMA No./Order No.';el.val()==''&&el.val(defaultValue);el.focus(function(){this.value=this.value==defaultValue?'':this.value}).blur(function(){this.value=this.value==''?defaultValue:this.value});$('#form-1').submit(function(){var val=$.trim(el.val()).replace(/[^\w+]/g,'');val=val==defaultValue.replace(/[^\w+]/g,'')?'':val;var url='/'+cur_lang_url+'m-users-a-rma_list';url+=$('select[name=time]').val()==1?'-time-1':'';url+=val==''?'':'-keyword-'+val;location.href=url+'.htm';return false});return this};RMA.checkForm=function(){var el=$('#form-rma_apply');if(el.length<1){return this}el.submit(function(){var flag=true;if(el.valid()){$('select[name="reason[]"]').each(function(index,item){if($(item).val()==''){alert(reason_msg);flag=false;$('html').animate({scrollTop:$(item).offset().top},300);return false}});flag&&$('textarea[name="desc[]"]').each(function(index,item){if($(item).val()==''){alert(description_msg);flag=false;$('html').animate({scrollTop:$(item).offset().top},300);$(item).focus();return false}flag=true});return flag?flag&&confirm(rma_confirm_address_msg):false}return true}).validate({errorClass:'invalid',success:'vaild',rules:{phone:{required:true,maxlength:15},email:{required:true,maxlength:60,email:true},consignee:{required:true,maxlength:70},address1:{required:true,maxlength:35},city:{required:true,maxlength:35},province:{required:true,maxlength:35},country:{required:true},zipcode:{required:true,maxlength:20},apply_type:{required:true},'desc[]':{required:true},'reason[]':{required:true}},messages:{phone:{required:rma_tel_msg,maxlength:$.format(validate_maxlength_msg)},email:{required:rma_email_msg,maxlength:$.format(validate_maxlength_msg)},consignee:{maxlength:$.format(validate_maxlength_msg)},address1:{required:rma_address1_msg,maxlength:$.format(validate_maxlength_msg)},city:{required:rma_city_msg,maxlength:$.format(validate_maxlength_msg)},province:{required:rma_province_msg,maxlength:$.format(validate_maxlength_msg)},country:{required:rma_country_msg},zipcode:{required:rma_zipcode_msg,maxlength:$.format(validate_maxlength_msg)},apply_type:{required:rma_choose_request_type},'desc[]':{required:rma_description_msg},'reason[]':{required:rma_reason_msg}},success:function(label){label.html("&nbsp;").addClass("checked")}});return this};RMA.tracking_number=function(){$('#btn-tracking_number').click(function(){var input=$('#txt-tracking_number');var tracking_number=input.val().trim();if(tracking_number){$.post('/'+cur_lang_url+'m-users-a-rma_tracking_number_submit.htm',{tracking_number:tracking_number,rma_order_id:$('#hidden-rma_order_id').val()},function(data){if(data&&data.indexOf('success')>0){alert(SUBMIT_SECCESSFULLY)}else{alert(SUBMIT_FAILED)}})}else{alert(rma_enter_tracking_nubmer);input.focus()}});return this};$(function(){RMA.list().returned().checkForm().tracking_number()});