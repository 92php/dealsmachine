(function(){
	setBrowerHistories();
	//导航显示
	$("#js_sideBarMenuHide").hover(function(){
        if (!$('body').data('__loaded__')) {
            $('body').data('__loaded__', true);
            $.get(DOMAIN +'/data-cache/goods_category_'+ js_cur_lang +'.htm?' + new Date().getTime(), function(data) {
                $("#goods_category").append(data);
            });
        } else {
			$(this).find("ul").show();
		}	
	},function(){
		$(this).find("ul").hide();
	});
	//图片放大start
	$('#js_jqzoom').jqueryzoom({xzoom:400,yzoom:258});
	//图片放大—滚动
	$("#js_scrollable .items").jCarouselLite({
		btnNext: "#js_scrollable .xiang_next",
		btnPrev: "#js_scrollable .xiang_prev",
		speed: 800,
		visible: 5
	});
	//图片放大—切换
	$("#js_scrollable img").mouseover(function() {
		$("#js_jqzoom img").attr({'src':$(this).attr("imgb"),'jqimg':$(this).attr("bigimg")});
	});
	//选择商品颜色
	$(".js_select_same_goods").change(function(){
		GLOBAL.CartCheckout.change_same_goods(this);
	});
	//提交到购物车
	$(".js_add_cart_button").click(function(){
		GLOBAL.CartCheckout.addcart(this);
	});
	//liveChat按钮点击聊天
	$("#js_liveChatBtn").click(function(){
	 var lpButtonCTTUrl='http://server.iad.liveperson.net/hc/88227012/?cmd=file&file=visitorWantsToChat&site=88227012&imageUrl='+location.protocol+'//server.iad.liveperson.net/hcp/Gallery/ChatButton-Gallery/English/General/1a&referrer='+escape(document.location);lpButtonCTTUrl = (typeof(lpAppendVisitorCookies) != 'undefined' ?lpAppendVisitorCookies(lpButtonCTTUrl) : lpButtonCTTUrl);window.open(lpButtonCTTUrl,'chat88227012','width=475,height=400,resizable=yes');return false; 
	});
	$("#ul-peijian").width($("#ul-peijian").children("li").length*$("#ul-peijian").children("li").outerHeight());
	
	$("ul.tab").find("li").each(function(i,v){
		var _this = $(this);
		var _i = i;
		_this.click(function(){
			_this.addClass("on")
				.siblings().removeClass("on");
			$("div.MainInfo_showBox").hide().eq(_i).show();
			if( _i==1){
				var $paymentMethWarp = $("div.MainInfo_showBox").eq(_i);
				if($paymentMethWarp.find("img.paymentMeth").length==0){
					//$paymentMethWarp.append('<img class="paymentMeth" src="/temp/skin3/ximages/xxp.gif"/>');
					$paymentMethWarp.append("<img class=\"paymentMeth\" src="+product_img+">");
				}
			}
		})
	});
	
	$(".yesBtn ").hover(function(){
		var msg = goods_point;
		TipShow($(this), msg,31,0);
	},function(){
		$("body").find(".TipBOx").remove();	
	});
	
	//goods 更改货币币种
	$("div.goods_hobi").hover(function(){
		var $this = $(this);

		$this.find("strong.goods_hobiT").addClass('goods_hobiT_hover');
		$this.find("ul").show();
	},function(){
		var $this = $(this);
		
		$this.find("strong.goods_hobiT").removeClass('goods_hobiT_hover');
		$this.find("ul").hide();
	});

	GLOBAL.LoadJS("http://cloud4.faout.com/imagecache/ba/sysjs/facebook_review.js","shareToFaceBook");
	//分享到faceBook
	GLOBAL.LoadJS("//connect.facebook.net/en_US/all.js#xfbml=1","facebook-jssdk");
	//分享到Tweet
	GLOBAL.LoadJS("//platform.twitter.com/widgets.js","shareTweet");
	//分享到Google+
	GLOBAL.LoadJS("https://apis.google.com/js/plusone.js","shareGoogle_1");
	//分享到pinit
	GLOBAL.LoadJS("//assets.pinterest.com/js/pinit.js","sharePinit");
	
	


/**
 * 设置浏览器历史
 * 
 * @author          mashanling
 * @date            2012-12-10 15:23:07
 * @last modify     2012-12-10 15:23:07
 * 
 * @return void 无返回值
 */

function setBrowerHistories() {
    var goodsId = $('#hidden-goodsId').val(),//商品id
    maxNum = 6,//最大保存数
    split = 'EOT',//商品分类分割符
    key = 'browserHistories',//cookie名称
    values = $('#hidden-history').val(),//当前商品信息
    histories = $.cookie(key);//浏览器历史
   
    if (goodsId && values) {
	
        var search = goodsId + '.htm', arr = [];
        
        if (histories) {
            var arr = histories.split(split);
            
            if (histories.indexOf(search) > -1) {//已经浏览器过，unshift到最前面
                
                for (var i = 0, len = arr.length; i < len; i++) {
                
                    if (arr[i].indexOf(search) > -1) {//干掉当前商品
                        arr.splice(i, 1);
                        break;
                    }
                }
            }
        }
        
        arr.unshift(values);
        
        arr = arr.length > maxNum ? arr.slice(0, maxNum) : arr;
        $.cookie(key, arr.join(split), {
            expires: 365, 
            path: '/',
            domain: COOKIESDIAMON
        });
    }
}//end setBrowerHistories

function TipShow(ele, msg, x, y, timer, callBack) {
    var _timer = 1200;
    var _x = 0;
    var _y = 0;
    if (typeof x == "number") {
        _x = x
    }
    if (typeof y == "number") {
        _y = y
    }
    if (typeof timer == "number") {
        _timer = timer;
    }
    var TipBOx = $(".TipBOx");
    var Left = ele.offset().left + parseInt(_y);
    var Top = ele.offset().top + parseInt(_x);
    var Css = {
        left: Left,
        top: Top,
        display: "none"
    };
	TipBOx=$('<div class="TipBOx"> <span class="TipBOx_bot"></span> '+msg+'</div>');
	$("body").append(TipBOx);
    TipBOx.css(Css).stop().show();
	if(typeof callBack =='function'){
		callBack();	
	}
}

//1760 0410A网产品详情页优化 by JMJ_20140414
//判断只有左边的模块高度大于右边的才发生以下事情
if($(".m_boxLeft").height() > $(".m_boxRight").height()){	
	var targetFixed = $("#div-history");	
	var toTopHeight = targetFixed.offset().top;	
	var toLeft = targetFixed.offset().left;
	$(window).scroll(function() {
		var winHeight = $(window).height();
		var docHeight = $(document).height();
		var hiddenHeight = targetFixed.height() - winHeight;
		//固定目标div的offsetLeft
		targetFixed.css('left', toLeft-10);
		// 判断目标div是否靠顶部
		if( ($(document).scrollTop()-hiddenHeight) > toTopHeight ){
			var scrollHeight = docHeight - winHeight - $("#footer").height();
			var positionTop = docHeight - (targetFixed.height() + $("#footer").height()) - 49;
			// 判断是否滚动到页面底部	
			if($(document).scrollTop() < scrollHeight){
				targetFixed.removeClass("nav_absolute").addClass("nav_fixed").css('top', -hiddenHeight);
			}else{		
				targetFixed.removeClass("nav_fixed").addClass("nav_absolute").css('top', positionTop);
			}	
		}else{
			targetFixed.removeClass("nav_fixed");
		}	
	})
}
})()