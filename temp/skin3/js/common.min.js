// JavaScript Document

//定义空间命名
var GLOBAL ={};
//邮件验证
	GLOBAL.checkmail=function(Email){
		var pattern=/^[\w][\.\w_-]+[\w]@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;
		flag=pattern.test(Email);
		if (flag){
			return true;
		}else{
			return false;
		}
	};
//图片懒加载
	GLOBAL.lazyLoad = function(selectBox){
		var $selectBox= $(selectBox);
		$selectBox.lazyload({
			threshold : 500,
			effect: "fadeIn",
			failure_limit : 40,
			skip_invisible : false
		});
	};
	
 //更改货币
	GLOBAL.Currency ={
		currencyBox:$("#js_currency"),
        bizhongList:$(".js_bizhongList").find("li"),
		
		change_houbi:function(){
			var that = this;
			
			that.redCookieHoubi();
			
			that.bizhongList.click(function(){
				var bizhong = $(this).data("bizhong");
				
				GLOBAL.Cookie.setCookie('bizhong',bizhong , {expires: 7, path: '/',domain:COOKIESDIAMON}); 
				$.cookie("setbizhong",1,{expires:7,path:"/",domain:COOKIESDIAMON});
				GLOBAL.Currency.changHtmlFun($(this),bizhong );
				
				that.currencyBox.html($(this).html());
			});
			
			
		},
		redCookieHoubi : function(){
			var that = this;
			var bizhong = GLOBAL.Cookie.redCookie('bizhong');
			/*if(bizhong == null){
				GLOBAL.Cookie.setCookie('bizhong','USD' , {expires: 7, path: '/',domain:COOKIESDIAMON}); 
				bizhong = GLOBAL.Cookie.redCookie('bizhong');
			}*/
			this.bizhongList.each(function(){
				var $this = $(this);
				if($this.data("bizhong")==bizhong){
					that.currencyBox.html($this.html());
				}
			});
			
			this.changHtmlFun($("#js_currency"),bizhong);
		},
		changHtmlFun : function(obj,bizhong){
			var _this = this;
			var $bizhongBox =$(".bizhong");
			var $myShopPriceBox = $(".my_shop_price");
			
			$bizhongBox.html(bizhong);
			$myShopPriceBox.each(function(i,o){
				yuanshi = $(this).attr('orgp');
				$(o).html((parseFloat(my_array[bizhong]) * parseFloat(yuanshi)).toFixed(2));
			});
		}
	};
 //$.cookie
	GLOBAL.Cookie={
		setCookie:function(name,value, options){
			$.cookie(name,value,options);
		},
		redCookie : function(name){
			return cookieValue = $.cookie(name);
		},
		delCookie : function(nanme){
			$.cookie(name,'');
		}
	};
//isLogin
	GLOBAL.isLogin=function(){
		var url=DOMAIN_USER+'/fun/index.php?act=chk_sign&jsoncallback=?';
		$.getJSON(url, function(data) {
			msg = data.ms;
			if (msg){
				$("#js_islogin").html(js_func_islogin_0+' '+ msg +'  <a rel=nofollow href="'+DOMAIN_USER+'/'+js_cur_lang_url + 'm-users-a-logout.htm">' + js_func_islogin_1 + '</a>');
			}else{
					$("#js_islogin").html(js_func_islogin_2+'! <a href="'+DOMAIN_USER+'/'+js_cur_lang_url + 'log-in/" rel=nofollow>'+js_func_islogin_3+'</a> '+ or +' <a href="'+DOMAIN_USER+'/'+js_cur_lang_url + 'sign-up/" rel=nofollow  style="color:#FF6600">'+js_func_islogin_4+'</a>');
			}
		})
	};
	
//购物车
	GLOBAL.CartCheckout = {
		//更新购物车数量
		cart_items:cart_items,
		addToCarEvent : function(obj){
			var _this = this;
			$(obj).click(function(){
				_this.addcart(this);
				return false;
			});
		},
		//添加商品到购物车
		addcart:function(obj){
			var act_sign = $(obj).attr('act_sign');
			var gid = $(obj).attr('gid');
			var num = $(obj).attr('num');
				num = (num == undefined)?1:num;
			var reflash = $(obj).attr('ref');
				reflash = (reflash == undefined)?0:reflash;
				cartval =  '';
			var attrchage = $(obj).attr('attrchage');
				attrchage = (attrchage == undefined)?'':attrchage;
			var geshuxing = '';
			var error_msg = '';
			var is_kong_msg = '';
			var dijige = '';
			var error_num = 1;
			var temparr = new Array();
			var is_combo = $(obj).attr('is_combo') == undefined?0:1;
			var msg_id = $(obj).attr('msg_id') == undefined?'':$(obj).attr('msg_id');
			if(attrchage.indexOf('|')>0){
				attrchage = attrchage.split('|');
				$.each(attrchage,function(i,v){
					temparr[i] = new Array();
					var type = $('.spec_'+v).attr('type');
					var lab_name = $('.spec_'+v).attr('lab_name');
					switch (type){
						   case 'select-one':
							   temparr[i] = $('.spec_'+v).val();
							   var isnes = $('.spec_'+v).attr('isnes');
							   if (isnes == '1'){
								   if (temparr[i] == "") {
									   is_kong_msg += error_num+js_func_addcart_0+lab_name+'!\n';
									   error_num++;
									   if (dijige==''){dijige = v;}
								   }
							   }
						   case 'checkbox':
								$('.spec_'+v+':checked').each(function(j){
									temparr[i][j] = $(this).val();
									if (temparr[i][j] == "") {is_kong_msg += error_num+js_func_addcart_0+lab_name+'!\n';error_num++;}
								});
					}

				});
			}else{
				if (attrchage!=''){
					dijige = attrchage;
					temparr[1] = new Array();
					var type = $('.spec_'+attrchage).attr('type');
					var lab_name = $('.spec_'+attrchage).attr('lab_name');
					switch (type){
						   case 'select-one':
							   temparr[1] = $('.spec_'+attrchage).val();
							   var isnes = $('.spec_'+attrchage).attr('isnes');
							   if (isnes == '1'){
								   if (temparr[1] == "") {is_kong_msg += js_func_addcart_0+lab_name+'!\n';}
							   }
						   case 'checkbox':
								$('.spec_'+attrchage+':checked').each(function(j){
									temparr[1][j] = $(this).val();
									if (temparr[1][j] == "") {is_kong_msg += js_func_addcart_0+lab_name+'!\n';}
								});
					}
				}else{
					temparr[1] =  $(this).attr('atrid');
					atrrid = $(this).attr('atrid');
				}
			}
			if(typeof(atrrid)=='undefined')atrrid='';
			if (is_kong_msg!="") {alert(js_func_addcart_1 + is_kong_msg);$('.spec_'+dijige).focus();return false;}
			cartval = temparr;
			target_div = msg_id ==''?"#add_cart_msg"+gid+atrrid:"#"+msg_id;
			if (error_msg !=''){ alert(error_msg);return false;}
			if(is_combo){
				var peijianId = '', el = $('#ul-peijian');
				if (el.length > 0) {//配件
					peijianId = el.find(':checked').map(function() {
						return $(this).val();
					}).get().join();
					
				}
			}else{
				peijianId ='';
			}
			var URL=DOMAIN_CART+'/'+js_cur_lang_url + "m-flow-a-add_to_cart.htm?jsoncallback=?&"+"goods_id="+gid+"&number="+num+"&spec="+cartval+"&attrchage="+attrchage+"&act_sign="+act_sign+'&peijian_id=' + peijianId;
			$.getJSON(URL, function(data) {
				msg = data.ms;
				if (msg.indexOf('Added To Cart')>0){  //当添加成功的时候执行并分解 1||Added To Cart
						var mag_arr = msg.split('||');
							cartnum = parseInt(mag_arr[0]);

						$(".all_red_cart_items").each(function(){$(this).html(cartnum);}); //刷新每一个
						$(target_div).html(mag_arr[1]+'<br><a href="'+DOMAIN_CART+'/'+js_cur_lang_url + 'shopping-cart/" class="view_cart"> '+js_func_addcart_2+' <span class="all_red_cart_items">'+cartnum+'</span>items(s)</a>');
						if (reflash == "1" ) re_load(DOMAIN_CART+'/'+js_cur_lang_url + 'shopping-cart/');
						GLOBAL.CartCheckout.cart_items();
				}else{
					   $(target_div).html(msg);
				}

			});
		},
		//商品属性改变
		change_same_goods:function(obj){
			var goods_id = parseInt(obj.value);
			if(goods_id > 0)
			{
				window.location.href = DOMAIN+'/'+js_cur_lang_url + 'best_' + goods_id + '.html';
			}
		}/* ,
		quantity:function(flage,bizhong,goodprice,orgp,item,callBack){
			var GoodCart ={};
			GoodCart.price  = goodprice;
			GoodCart.orgp = orgp;
			GoodCart.bizhong =  bizhong;
			GoodCart.item =  item-0+flage;
			if(GoodCart.item<=1 || (isNaN(GoodCart.item))){
				GoodCart.item =1;
			}
			if(callBack){
				callBack(GoodCart);
			}
		} */
	};
	
//底部相关的js
	GLOBAL.Foot={
		helpForm:{
			//底部表单框获取/失去焦点
			InputFocus: function(){
                var _this=this;
				 $(".js_footHelp_input").focus(function(){
                     _this.setFocus(this, this.value, '#333');
				}); 
			},
			setFocus:function(obj, def, color){
				def = def || obj.defaultValue;
				obj.value.trim() == def ? obj.value = '' : '';
				obj.onblur = function() {
					obj.value.trim() == '' ? obj.value = def : '';
				};
				color ? obj.style.color = color : '';
				return obj;
			},
			//发布邮件 
			setEmail: function(){
				$('.js_btn-subscribe').click(function() {
					var el = $(this).parent().find($('.js_txt-subscribe'));
					var email = el.val();
					
					if (!email) {
						alert(js_func_subscribe_2);
						el.focus();
						return false;
					}else if (!GLOBAL.checkmail(email)) {
						alert(js_func_subscribe_3);
						el.focus();
						return false;
					}
					var postData = 'source=2';
					var url = DOMAIN_CART+'/'+cur_lang+'/m-users-a-email_list-job-add-email-' + email + '.htm?jsoncallback=?';
					$.getJSON(url,postData, function(data) {var msg = data.info;alert(msg);});
				});
			}
			
		}
	};
//liveChat显示隐藏
	GLOBAL.LiveChat = function(){
		$(".topMenu").hover(function(){
			$(this).find("h4.topMenu_title").addClass("hoverClass");
			$(this).find(".topMenu_box").show();
		},function(){
			$(this).find("h4.topMenu_title").removeClass("hoverClass");
			$(this).find(".topMenu_box").hide();
		});
	};
	
//搜索框相关
	GLOBAL.SeachObj={
		$seachBox : $("#js_k2"),
		$categoryBox : $("#category"),
		$seachForm : $("#js_topsearchform"),
		kw_onfocus:function(){
			this.$seachBox.focus(function(){
				var $this = $(this);
				tips_word=$this.attr('tips');
				kw = $.trim($this.val());
				if (kw==tips_word||kw == new_arrival || kw == search_keyword){
					$this.val('');
				}
				$this.attr('style','color:#000000');
			});
		},
		//搜索框验证
		seachSubmitFun : function(){
			var kw = $('#js_k2').val().trim().replace(/\/|\\|\s/g, '-');
			kw = kw.toLocaleLowerCase();
			kw = title2url(kw);
			category = $.trim(this.$categoryBox.val());
			if ((kw == '') || (kw == 'Products-keyword')){
				alert(js_func_seach_submit_0);
				this.$seachBox.val('').focus();
				return false;
			}else{				
				if (category == '0'){
					//window.location.href=DOMAIN+'/'+js_cur_lang_url + 'affordable/'+kw+'.html';
					$('#js_topsearchform').attr('action', DOMAIN+'/'+js_cur_lang_url + 'affordable-'+kw+'/');
				}else{
					//window.location.href=DOMAIN+'/'+js_cur_lang_url + 'affordable/'+kw+'/'+category+'/';
					$('#js_topsearchform').attr('action', DOMAIN+'/'+js_cur_lang_url + 'affordable/'+kw+'/'+category+'/');
				}
				return true;
			}
		},
		//搜索框提交
		seachSubmit:function(){
			this.$seachForm.submit(function(){
				GLOBAL.SeachObj.seachSubmitFun();
				//return false;
			});
		},
		//搜索框输入提示
		autocompleteFun : function(){
			this.$seachBox.autocomplete(DOMAIN+"/m-autosearch.htm", {width:386,scroll:false,autoFill: false,selectFirst: false,formatItem: function(row, i, max) {
					return "<span style='float:left; margin-left:3px; width:370px;text-align:left;'>" + row[0] + "</span>";
				}
			}).result(function(event, item) { location.href = DOMAIN+'/'+js_cur_lang_url + 'affordable/'+item[1]+'/';});	
		}
	};
//左边相关
	GLOBAL.LeftObj={
		//左边子导航
		submenu : function(){
			var $subMenui = $(".js_sidebar_menu");
			var litem = ".js_litem";
			var litemList = ".js_litem_list";
			var subitem = ".js_subitem";
			var hoverClass = "hover_litem_list";
			 /*$subMenui.on("mouseover",litem,function(){
				$(this).find(litemList).stop().addClass(hoverClass);
				//$(this).find(subitem).show();
			});
			 $subMenui.on("mouseleave",litem,function(){
				$(this).find(litemList).stop().removeClass(hoverClass);
				//$(this).find(subitem).hide();
			});*/
		},
		ddsmoothmenu:{
			//Specify full URL to down and right arrow images (23 is padding-right added to top level LIs with drop downs):
			arrowimages: {down:['downarrowclass', '/temp/skin3/images/styleimg/down.gif', 23], right:['rightarrowclass', '/temp/skin3/images/styleimg/leftmenu_icon.gif']},
			transition: {overtime:0, outtime:0}, //duration of slide in/ out animation, in milliseconds
			shadow: {enabled:true, offsetx:0, offsety:0},
			///////Stop configuring beyond here///////////////////////////
			detectwebkit: navigator.userAgent.toLowerCase().indexOf("applewebkit")!=-1, //detect WebKit browsers (Safari, Chrome etc)
			detectie6: document.all && !window.XMLHttpRequest,
			getajaxmenu:function($, setting){ //function to fetch external page containing the panel DIVs
				var $menucontainer=$('#'+setting.contentsource[0]); //reference empty div on page that will hold menu
				$menucontainer.html(ddsmoothmenu_ddsmoothmenu_0);
				$.ajax({
					url: setting.contentsource[1], //path to external menu file
					async: true,
					error:function(ajaxrequest){
						$menucontainer.html(ddaccordion_ddaccordion_1 + ajaxrequest.responseText);
					},
					success:function(content){
						$menucontainer.html(content);
						GLOBAL.LeftObj.ddsmoothmenu.buildmenu($, setting);
					}
				})
			},
			
			buildmenu:function($, setting){
				var smoothmenu=GLOBAL.LeftObj.ddsmoothmenu;
				var $mainmenu=$("#"+setting.mainmenuid+">ul"); //reference main menu UL
				if(typeof($mainmenu.parent().get(0))!='undefined'){
					$mainmenu.parent().get(0).className=setting.classname || "ddsmoothmenu";
				}
				var $headers=$mainmenu.find("ul").parent();
				$headers.hover(
					function(e){
						$(this).children('a:eq(0)').addClass('selected');
					},
					function(e){
						$(this).children('a:eq(0)').removeClass('selected');
					}
				)
				$headers.each(function(i){ //loop through each LI header
					var $curobj=$(this).css({zIndex: 1000-i}).attr('id','chcss');//reference current LI header
					var $subul=$(this).find('ul:eq(0)').css({display:'block'});
					this._dimensions={w:this.offsetWidth, h:this.offsetHeight, subulw:$subul.outerWidth(), subulh:$subul.outerHeight()}
					this.istopheader=$curobj.parents("ul").length==1? true : false; //is top level header?
					$subul.css({top:this.istopheader && setting.orientation!='v'? this._dimensions.h+"px" : 0});
					$curobj.children("a:eq(0)").css(this.istopheader? {paddingRight: smoothmenu.arrowimages.down[2]} : {}).append( //add arrow images
						'<img src="'+ (this.istopheader && setting.orientation!='v'? smoothmenu.arrowimages.down[1] : smoothmenu.arrowimages.right[1])
						+'" class="' + (this.istopheader && setting.orientation!='v'? smoothmenu.arrowimages.down[0] : smoothmenu.arrowimages.right[0])
						+ '" style="border:0;" />'
					)
					
					if (smoothmenu.shadow.enabled){
						this._shadowoffset={x:(this.istopheader?$subul.offset().left+smoothmenu.shadow.offsetx : this._dimensions.w), y:(this.istopheader? $subul.offset().top+smoothmenu.shadow.offsety : $curobj.position().top)} //store this shadow's offsets
						if (this.istopheader){
							$parentshadow=$(document.body)
						}else{
							var $parentLi=$curobj.parents("li:eq(0)");
							$parentshadow=$parentLi.get(0).$shadow;
						}
						this.$shadow=$('<div class="ddshadow'+(this.istopheader? ' toplevelshadow' : '')+'"></div>').prependTo($parentshadow).css({left:this._shadowoffset.x+'px', top:this._shadowoffset.y+'px'})  //insert shadow DIV and set it to parent node for the next shadow div
					}
					$curobj.hover(
						function(e){
							var $targetul=$(this).children("ul:eq(0)");
							this._offsets={left:$(this).offset().left, top:$(this).offset().top}
							var menuleft=this.istopheader && setting.orientation!='v'? 0 : this._dimensions.w;
							menuleft=(this._offsets.left+menuleft+this._dimensions.subulw>$(window).width())? (this.istopheader && setting.orientation!='v'? -this._dimensions.subulw+this._dimensions.w : -this._dimensions.w) : menuleft; //calculate this sub menu's offsets from its parent
							if ($targetul.queue().length<=1){ //if 1 or less queued animations
								$targetul.css({left:menuleft+"px", width:this._dimensions.subulw+'px'}).animate({height:'show',opacity:'show'}, GLOBAL.LeftObj.ddsmoothmenu.transition.overtime)
								if (smoothmenu.shadow.enabled){
									var shadowleft=this.istopheader? $targetul.offset().left+GLOBAL.LeftObj.ddsmoothmenu.shadow.offsetx : menuleft;
									var shadowtop=this.istopheader?$targetul.offset().top+smoothmenu.shadow.offsety : this._shadowoffset.y;
									if (!this.istopheader && GLOBAL.LeftObj.ddsmoothmenu.detectwebkit){ //in WebKit browsers, restore shadow's opacity to full
										this.$shadow.css({opacity:1});
									}
									this.$shadow.css({overflow:'', width:this._dimensions.subulw+'px', left:shadowleft+'px', top:shadowtop+'px'}).animate({height:this._dimensions.subulh+'px'}, GLOBAL.LeftObj.ddsmoothmenu.transition.overtime)
								}
							}
						},
						function(e){
							var $targetul=$(this).children("ul:eq(0)");
							$targetul.animate({height:'hide', opacity:'hide'}, GLOBAL.LeftObj.ddsmoothmenu.transition.outtime);
							if (smoothmenu.shadow.enabled){
								if (GLOBAL.LeftObj.ddsmoothmenu.detectwebkit){ //in WebKit browsers, set first child shadow's opacity to 0, as "overflow:hidden" doesn't work in them
									this.$shadow.children('div:eq(0)').css({opacity:0});
								}
								this.$shadow.css({overflow:'hidden'}).animate({height:0}, GLOBAL.LeftObj.ddsmoothmenu.transition.outtime);
							}
						}
					) //end hover
				}) //end $headers.each()
				$mainmenu.find("ul").css({display:'none', visibility:'visible'});
			},
			init:function(setting){
				if (typeof setting.customtheme=="object" && setting.customtheme.length==2){ //override default menu colors (default/hover) with custom set?
					var mainmenuid='#'+setting.mainmenuid;
					var mainselector=(setting.orientation=="v")? mainmenuid : mainmenuid+', '+mainmenuid;
					document.write('<style type="text/css">\n'
						+mainselector+' ul li a {background:'+setting.customtheme[0]+';}\n'
						+mainmenuid+' ul li a:hover {background:'+setting.customtheme[1]+';}\n'
					+'</style>')
				}
				this.shadow.enabled=(document.all && !window.XMLHttpRequest)? false : true //in IE6, always disable shadow
				jQuery(document).ready(function($){ //ajax menu?
					if (typeof setting.contentsource=="object"){ //if external ajax menu
						GLOBAL.LeftObj.ddsmoothmenu.getajaxmenu($, setting)
					}
					else{ //else if markup menu
						GLOBAL.LeftObj.ddsmoothmenu.buildmenu($, setting)
					}
				})
			}
		},
		//左边图片滚动
		scrollUpimg:function(scrollObj,time){
			var $scrollObj = $(scrollObj);
			var _time = time;
			var _bland = setInterval(function(){
					scrollUpimgFun();
			},_time);
			$scrollObj.hover(function(){
				clearInterval(_bland);
			},function(){
				_bland = setInterval(function(){
					scrollUpimgFun();
				},_time);
			});
			function scrollUpimgFun(){
				var scrollHeight =$scrollObj.find("li:first").outerHeight()-0;
					$scrollObj.find("li:first").animate({marginTop:-scrollHeight+'px'},500,function(){
						$(this).css("margin-top",0).appendTo($scrollObj);
					});		
			};
		}
	};
//问卷调查
	GLOBAL.survey={
		vote:function(v){
			$.ajax({
				type: "get",
				url: "?",
				data: "a=vote"+'&v=' + v,
				dataType:"text",
				success: function(msg){
					$('#js_PVot').html(''+ feedback +'');
					'function' == typeof(vote_callback) && vote_callback(v);//回调 by mashanling on 2013-06-01 13:47:17
				}
			})
		},
		//回答问卷
		upSurvey:function(){
			var _this = this;
			$('#js_surveyYes').click(function(){_this.vote('y')});
			$('#js_surveyNo').click(function(){_this.vote('n')});
		}	
	};
//浮动框
    GLOBAL.FloatObj={
        goToUp:function(){
            var $backToTopTxt = "",
            $backToTopEle = $('<div class="backToTop"></div>').appendTo($("body")).text($backToTopTxt).attr("title", $backToTopTxt).click(function() {$("html, body").animate({ scrollTop: 0 }, 120); }),
            $backToTopFun = function() {
                var st = $(document).scrollTop(), winh = $(window).height();
                (st > 0)? $backToTopEle.show(): $backToTopEle.hide();
                if (!window.XMLHttpRequest) {
                    $backToTopEle.css("top", st + winh - 166);
                }
            };
            $(window).bind("scroll", $backToTopFun);
            //$(function() { $backToTopFun(); });
        }
    };
//动态加载js不支持回调函数
	GLOBAL.LoadJS=function(src, id){
		var scriptTag = document.getElementById(id);
		var oScript = document.createElement("script");
		if(scriptTag) return;
		oScript.id = id;
		oScript.src = src;
		document.getElementsByTagName("body")[0].appendChild(oScript);
	};

$(document).ready(function(){
	//图片懒加载
	 GLOBAL.lazyLoad("img.js_lazyLoad");
	//更改货币
	 GLOBAL.Currency.change_houbi();
	//是否已经登录
	 GLOBAL.isLogin();
	//LiveChat显示隐藏
	 GLOBAL.LiveChat() ;
	//搜索框获得焦点
	GLOBAL.SeachObj.kw_onfocus();
	//搜索框提交
	GLOBAL.SeachObj.seachSubmit();
	//搜索框输入提示
	GLOBAL.SeachObj.autocompleteFun();
	//更新购物车数量
	GLOBAL.CartCheckout.cart_items();
	//底部表单框获取/失去焦点
	GLOBAL.Foot.helpForm.InputFocus();
	//底部表单发布邮件 
	GLOBAL.Foot.helpForm.setEmail();
	//左边子导航
	GLOBAL.LeftObj.submenu();
	GLOBAL.LeftObj.ddsmoothmenu.init({
		mainmenuid: "smoothmenu", //Menu DIV id
		orientation: 'v', //Horizontal or vertical menu: Set to "h" or "v"
		classname: 'ddsmoothmenu-v', //class added to menu's outer DIV
		//customtheme: ["#804000", "#482400"],
		contentsource: "markup" //"markup" or ["container_id", "path_to_menu_file"]
	});
	//左边图片向上滚动
	GLOBAL.LeftObj.scrollUpimg("#js_upSlide",2000);
    //返回顶部
    GLOBAL.FloatObj.goToUp();
	
	//删除购物车
	$('#del_action').live("click",function (){
		delatr = ($(this).attr('delatr')!=undefined)?$(this).attr('delatr'):'';  //删除连接
		gid    = ($(this).attr('gid')!=undefined)?$(this).attr('gid'):'';
		gifts_id    = ($(this).attr('gifts_id')!=undefined)?$(this).attr('gifts_id'):0;
		if(is_include_gifts>0 && gifts_id == 0)
			delmsg = js_del_action_0;
		else
			delmsg = ($(this).attr('delmsg')!=undefined)?$(this).attr('delmsg'):js_del_action_1; //确认信息
		if ((confirm(delmsg)) && (delatr!='')){
			list_load(delatr,"#del_ajax_msg"+gid,"#cart"+gid);
			GLOBAL.CartCheckout.cart_items()
		}
	});

	//从购物车放入收藏
	$('#add_favour_msg').live("click",function (){
		delatr = ($(this).attr('delatr')!=undefined)?$(this).attr('delatr'):'';  //删除连接
		gid    = ($(this).attr('gid')!=undefined)?$(this).attr('gid'):'';
		delmsg = ($(this).attr('delmsg')!=undefined)?$(this).attr('delmsg'):js_del_action_1; //确认信息
		if ((confirm(delmsg)) && (delatr!='')){
				$.ajax({
					type: "GET",
					url: delatr,
					beforeSend:function(){$("#del_ajax_msg"+gid).html("<img src='/temp/skin1/images/990000_bai.gif' id='verify' style='vertical-align: middle' > " + reviews_func_check_btn_signin_3);	},
					success: function(msg){
						re_load(DOMAIN_CART+'/'+js_cur_lang_url + 'shopping-cart/');
						GLOBAL.CartCheckout.cart_items();
					}
				});
		}
	});

	//更新购物车
	$(".goods_number").live('keyup',function (){
		var el = $(this);
		num = $(this).val();
		o_goods_number = $(this).attr('o_goods_number');
		if(o_goods_number=='undefined')o_goods_number=0;
		if (!num) return false;
		//alert(o_goods_number);
		if(is_include_gifts>0 && o_goods_number>num){
			msg = js_goods_number_0;
			if(!confirm(msg)){
				$(this).val(o_goods_number);
				return false;
			}
		}
		//中奖购买数量限制
		lmt_num = $(this).attr('lmt_num');
		if (lmt_num>0 && num < lmt_num){
			alert(js_goods_number_1 + lmt_num+'!');
			$(this).val(lmt_num);
			return false;
		}
		var mainGoodsId = parseInt(el.attr('main_goods_id'));//主商品id
		var max = parseInt($('.hidden-' + mainGoodsId).val());
		//alert(mainGoodsId);
		if (mainGoodsId && num > max) {
			alert(js_goods_number_2);
			el.val(max);
			return false;
		}
		rid = ($(this).attr('rid')!=undefined)?$(this).attr('rid'):'';
		$.ajax({
			type: "POST",
			url: DOMAIN_CART+'/'+js_cur_lang_url + 'm-flow-a-update_cart.htm',
			data:'rid='+rid+'&goods_number='+num,
			beforeSend:function(){$("#num"+rid).html("<img src='temp/skin3/images/styleimg/indicator.gif'/>");},
			success: function(msg){
				if (msg=='Updated'){
					$("#num"+rid).html('');
					var callBack = typeof inCheckout == 'undefined'?"": chooseCheapest;
					re_load(DOMAIN_CART+'/'+js_cur_lang_url + 'm-flow-a-' + (typeof inCheckout == 'undefined' ? 'cart' : 'checkout') + '.htm?ajax=true',callBack);
				}else{
					$("#num"+rid).html(msg);
				}
			}
		});
	});
	$(".jian_num").live("click",function (){
		var rec_id = $(this).attr("atrid");
		var item = $('#goods_number_' + rec_id);
		var orig = Number(item.val());
		if(orig > 1){
			item.val(orig - 1);
			item.keyup();
		}
	 });
	$(".jia_num").live("click",function (){
		var rec_id = $(this).attr("atrid");
		var item = $('#goods_number_' + rec_id);
		var orig = Number(item.val());
		item.val(orig + 1);
		item.keyup();
	 });
	//根据国家查看运费
	$("#selcountries").live('change',function (){
			var country = $("#selcountries").val();
			if (country == '') return false;
			$.ajax({
				type: "POST",
				url: DOMAIN_CART+'/'+js_cur_lang_url + 'shopping-cart/?country='+country,
				beforeSend:function(){$("#load_ajax_msg").html(" <img src='/temp/skin1/images/990000_bai.gif' id='verify' style='vertical-align: middle' > " + reviews_func_check_btn_signin_3);	},
				success: function(msg){
					$("#load_ajax_msg").html('');
					var stext = $(msg).find('#shipajax').html();
					$('#shipajax').html(stext);
					show_my_shop_price('#shipajax');
					$(".bizhong").html($.cookie('bizhong'));
				}
			});
	 });
	 
	 
$("#accessory_select").live('change',function (){
    var bizhong=$(".bizhong").html();
    var select_prev=$("#select_prev").val();
    var select_prev=parseFloat(select_prev);
    var val=$(this).find("option:selected").attr("subprice"); //alert(val);
    val=(parseFloat(my_array[bizhong]) * parseFloat(val));
    //if(val)
    //{
         val=parseFloat(val.toFixed(2));
         //alert(val);

         var unit_price=$("#unit_price").html();
         unit_price=parseFloat(unit_price);
         var n=$("#input_quantity").val();

         if(select_prev==0)
           unit_price=unit_price+val;
         else
           unit_price=unit_price+val-select_prev;

         unit_price=unit_price.toFixed(2);
         $("#unit_price").html(unit_price);
         var str='<span class="bizhong" style="color:red;">'+bizhong+'</span><font color="red"> '+unit_price+'</font> x '+n+' = <span class="bizhong" style="color:red;">'+bizhong+'</span><font color="red"> '+unit_price * n+'</font>';
         $('#items_total').html(str);
    //}
    $("#select_prev").val(val);
 });

	$("#para_accessory").find("input").live('click',function (){
		 var bizhong=$(".bizhong").html();
		 var val=$(this).attr("val");
		 var unit_price=$("#unit_price").html();
		 var n=$("#input_quantity").val();
		 val=(parseFloat(my_array[bizhong]) * parseFloat(val)); //alert(val);
		 unit_price=parseFloat(unit_price);
		 checked=$(this).attr("checked");
		 if(checked)
		   unit_price=unit_price+val;
		 else
		   unit_price=unit_price-val;
		 unit_price=unit_price.toFixed(2);
		 $("#unit_price").html(unit_price);
		 str='<span class="bizhong" style="color:red;">'+bizhong+'</span><font color="red"> '+unit_price+'</font> x '+n+' = <span class="bizhong" style="color:red;">'+bizhong+'</span><font color="red"> '+unit_price * n+'</font>';
		 $('#items_total').html(str);
	 });		
	pajianCheckbox();
	
	if(jQuery.validator){
		jQuery.validator.addMethod("checkUserName", function(value, element) {   
			var tel = /\d/;
			return this.optional(element) || (!tel.test(value));
		}, 'Can not contain numbers');
	}	
		
});

//添加书签
function addbookmark(obj){
	var weburl = $(obj).attr('href');
	ymPrompt.win({message:weburl,width:870,height:450,title:js_func_addbookmark_0,handler:null,maxBtn:true,minBtn:true,iframe:true});
};

//订阅邮件
function subscribe(){
	var firstname = $('#sub_firstname').val();
	var email     = $('#sub_email').val();
	if (!firstname){ alert(js_func_subscribe_0); $('#sub_firstname').focus(); return false; }
	if (firstname.length > 25){ alert(js_func_subscribe_1); $('#sub_firstname').focus(); return false; }
	if (!email){alert(js_func_subscribe_2);  $('#sub_email').focus();return false;}
	if (!checkmail(email)){alert(js_func_subscribe_3);  $('#sub_email').focus();return false;}

	$.ajax({
		type: "GET",
		url: DOMAIN_USER+'/'+js_cur_lang_url + 'index.php?m=users&a=email_list&job=add&email=' + email +'&firstname='+firstname,
		success: function(msg){ alert(msg); }
	});
};

function checkmail(Email)
{
    var pattern=/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+/;
    flag=pattern.test(Email);
    if (flag){
		return true;
	}else{
        return false;
    }
}

function setTab(m,n){
 var tli=document.getElementById("menu"+m).getElementsByTagName("li");
 var mli=document.getElementById("main"+m).getElementsByTagName("ul");
 for(i=0;i<tli.length;i++){
  //tli[i].className=i==n?str1[n]:str2[n];
  if (i == n ) {
	  tli[i].className = 'pr_'+(n+1)+'_2';
	}else{
	  tli[i].className = 'pr_'+(i+1)+'_1';
	}
  mli[i].style.display=i==n?"block":"none";
 }
};


function setdetails(m,n){
 var tli=document.getElementById("menu"+m).getElementsByTagName("li");
 var mli=$("[ectype='showtable']");
 for(i=0;i<tli.length;i++){
  //tli[i].className=i==n?str1[n]:str2[n];
  if (i == n ) {
	  tli[i].className = 'pr_'+(n+1)+'_2';
	}else{
	  tli[i].className = 'pr_'+(i+1)+'_1';
	}
  mli[i].style.display=i==n?"block":"none";
 }
};

function talkall(st){
	ymPrompt.win({message:'online.html',width:270,height:155,title:js_func_talkall_0,handler:null,maxBtn:true,minBtn:true,iframe:true});
};

//显示自定义框
function show_custom(key,goods_id){
    var item_value = $('.spec_'+key+' option:selected').text();
	if (item_value == "custom made"){
	    ymPrompt.win({message:DOMAIN+'/'+js_cur_lang_url + 'm-goods-temp-show.htm?id='+goods_id+'&attr='+key,width:840,height:520,title:js_func_show_custom_0,handler:function(){$('.spec_'+key)[0].selectedIndex = 0;},maxBtn:true,minBtn:true,iframe:true});
	}else{
		//$("#custom"+key).hide();
	};

};

//显示复选自定义框
function show_check_custom(key){
	///alert($(".spec_"+key).val());
	if ($("#customxx"+key).attr("checked")){
		$("#custom"+key).show();
	}else{
		$("#custom"+key).hide();
	};
};

function show_my_shop_price(selectid){
	if (selectid!='')selectid +=' ';
	if ($.cookie('bizhong') == null){
		$.cookie('bizhong', 'USD', {expires: 7, path: '/', domain: COOKIESDIAMON});
	}

   $(selectid+".my_shop_price").each(function(i,o) {
		yuanshi = $(this).attr('orgp');
		$(o).html((parseFloat(my_array[$.cookie('bizhong')]) * parseFloat(yuanshi)).toFixed(2));
	});

$(".bizhong").html($.cookie('bizhong'));
$("#cur_jiancheng").html($.cookie('bizhong'));
};

/**
 * 获取参数
 *
 * @param {string} name 参数
 * @param {string} str  待获取字符串
 *
 * @return {string} 参数值
 */
function _GET(name, str) {
    var pattern = new RegExp('[\?&]' + name + '=([^&]+)', 'g');
    str = str || location.search;
    var arr, match = '';

    while ((arr = pattern.exec(str)) !== null) {
        match = arr[1];
    }

    return match;
}

//更新购物车数量
function cart_items(){
	URL=DOMAIN_CART+'/fun/?act=cart_item&noscript=1&jsoncallback=?';
    
    var lkid = _GET('lkid', location.hash.indexOf('lkid=') > 0 ? '?' + location.hash.substr(1) : null);
    
    if (lkid) {//lkid by mashanling on 2013-09-05 11:46:45
        URL += '&lkid=' + lkid + '&referer_url=' + (document.referrer ? encodeURIComponent(document.referrer) : '');
    }
    
	$.getJSON(URL, function(data) {
		msg = data.ms;
		$("#js_cart_items,.cart_items").html(msg);
	})

};

//添加商品到购物车
function addcart(obj){
	//alert(DOMAIN_CART);
    var act_sign = $(obj).attr('act_sign');
	var gid = $(obj).attr('gid');
	var num = $(obj).attr('num');
		num = (num == undefined)?1:num;
	var reflash = $(obj).attr('ref');
		reflash = (reflash == undefined)?0:reflash;
		cartval =  '';
	var attrchage = $(obj).attr('attrchage');
		attrchage = (attrchage == undefined)?'':attrchage;
	var geshuxing = '';
	var error_msg = '';
	var is_kong_msg = '';
	var dijige = '';
	var error_num = 1;
	var temparr = new Array();
	var is_combo = $(obj).attr('is_combo') == undefined?0:1;
	var msg_id = $(obj).attr('msg_id') == undefined?'':$(obj).attr('msg_id');
	//alert($(obj).attr('msg_id'));
	//alert(gid);
	if(attrchage.indexOf('|')>0){
		attrchage = attrchage.split('|');
		$.each(attrchage,function(i,v){
			temparr[i] = new Array();
			var type = $('.spec_'+v).attr('type');
			var lab_name = $('.spec_'+v).attr('lab_name');
			switch (type){
				   case 'select-one':
					   temparr[i] = $('.spec_'+v).val();
					   var isnes = $('.spec_'+v).attr('isnes');
					   if (isnes == '1'){
						   if (temparr[i] == "") {
							   is_kong_msg += error_num+js_func_addcart_0+lab_name+'!\n';
							   error_num++;
							   if (dijige==''){dijige = v;}
						   }
					   }
				   case 'checkbox':
						$('.spec_'+v+':checked').each(function(j){
							temparr[i][j] = $(this).val();
							if (temparr[i][j] == "") {is_kong_msg += error_num+js_func_addcart_0+lab_name+'!\n';error_num++;}
						});
			}

		});
	}else{
		if (attrchage!=''){
			dijige = attrchage;
			temparr[1] = new Array();
			var type = $('.spec_'+attrchage).attr('type');
			var lab_name = $('.spec_'+attrchage).attr('lab_name');
			switch (type){
				   case 'select-one':
					   temparr[1] = $('.spec_'+attrchage).val();
					   var isnes = $('.spec_'+attrchage).attr('isnes');
					   if (isnes == '1'){
						   if (temparr[1] == "") {is_kong_msg += js_func_addcart_0+lab_name+'!\n';}
					   }
				   case 'checkbox':
						$('.spec_'+attrchage+':checked').each(function(j){
							temparr[1][j] = $(this).val();
							if (temparr[1][j] == "") {is_kong_msg += js_func_addcart_0+lab_name+'!\n';}
						});
			}
		}else{
			temparr[1] =  $(this).attr('atrid');
			atrrid = $(this).attr('atrid');
		}
	}
	if(typeof(atrrid)=='undefined')atrrid='';
	if (is_kong_msg!="") {alert(js_func_addcart_1 + is_kong_msg);$('.spec_'+dijige).focus();return false;}
	cartval = temparr;

	target_div = msg_id ==''?"#add_cart_msg"+gid+atrrid:"#"+msg_id;
	//alert(target_div);
	if (error_msg !=''){ alert(error_msg);return false;}


	if(is_combo){
		var peijianId = '', el = $('#ul-peijian');

		if (el.length > 0) {//配件
			peijianId = el.find(':checked').map(function() {
				return $(this).val();
			}).get().join();
		}
	}else{

		peijianId ='';
	}
	URL=DOMAIN_CART+'/'+js_cur_lang_url + "m-flow-a-add_to_cart.htm?jsoncallback=?&"+"goods_id="+gid+"&number="+num+"&spec="+cartval+"&attrchage="+attrchage+"&act_sign="+act_sign+'&peijian_id=' + peijianId;
    $.getJSON(URL, function(data) {
		msg = data.ms;
		if (msg.indexOf('Added To Cart')>0){  //当添加成功的时候执行并分解 1||Added To Cart
				var mag_arr = msg.split('||');
					cartnum = parseInt(mag_arr[0]);

				$(".all_red_cart_items").each(function(){$(this).html(cartnum);}); //刷新每一个
				$(target_div).html(mag_arr[1]+'<br><a href="'+DOMAIN_CART+'/'+js_cur_lang_url + 'shopping-cart/" class="view_cart"> '+js_func_addcart_2+' <span class="all_red_cart_items">'+cartnum+'</span>items(s)</a>');

				if (reflash == "1" ) re_load(DOMAIN_CART+'/'+js_cur_lang_url + 'shopping-cart/');
				GLOBAL.CartCheckout.cart_items()
		}else{
			   $(target_div).html(msg);
		}

    });
}
//刷新购物车中商品数量
//检查自定义属性是否填写和是否超长。
function check_values(vals,error_msg,duixiang){
	if (vals == ''){
	   error_msg += duixiang + js_func_check_values_0;
	}else if (vals.length > 120){
	   error_msg += duixiang + js_func_check_values_1;
	}
	 return error_msg;
};

function re_load(page_url, callback){
	//return;
	//alert(page_url);
	$.ajax({
		type: "GET",
		url: page_url,
		cache:false,
		success: function(msg){
			//window.location.reload();

			var stext = $(msg).find('#cart_list').html();
			//alert(stext);
			$('#cart_list').html(stext);
			//alert(stext);
			show_my_shop_price('');
			$(".bizhong").html($.cookie('bizhong'));
            typeof(callback) == 'function' && callback();
		}
	});
};

function list_load(page_url,tobj,obj, callback){
	$.ajax({
		type: "GET",
		url: page_url,
		beforeSend:function(){$(tobj).html("<img src='temp/skin3/images/styleimg/indicator.gif' id='verify' style='vertical-align: middle' > " + reviews_func_check_btn_signin_3);	},
		success: function(msg){
			if (msg=='Deleted'){
				$(obj).hide("slow");
				//$(obj).animate({opacity:"toggle"},"slow");
				//$(obj).remove("slow");
				re_load(DOMAIN_CART+'/'+js_cur_lang_url + 'm-flow-a-' + (typeof inCheckout == 'undefined' ? 'cart' : 'checkout') + '.htm?ajax=true', callback);
			}
			 $(tobj).html(msg);
		}
	});
};


//详细页面商品数量 减 每次减1
function jian(){
    price= parseFloat($("#unit_price").html());
	var item = $('#input_quantity');
	var orig = Number(item.val());
    var bizhong=$(".bizhong").html();
	if(orig > 1){
        n=orig - 1;
		item.val(n);
		item.keyup();
        //var str='<span class="bizhong" style="color:red;">'+bizhong+'</span><font color="red"> '+price+'</font> x '+n+' = <span class="bizhong" style="color:red;">'+bizhong+'</span> <font color="red">'+(price * n).toFixed(2)+'</font>';
        //$('#items_total').html(str);
	}

};


/**
 * 配件复选框
 *
 * @return {void} 无返回值
 */
function pajianCheckbox() {

    var el = $('#ul-peijian');

    if (el.length > 0) {
        el.find(':checkbox').click(function() {
            var el = $(this), elParent = el.parents('li:first');
            elParent.toggleClass('choose');

            input_quantity($('#input_quantity')[0]);//重新计算总价
        });
    }
}


//详细页面商品数量 加 每次加1
function jia(){

    price= parseFloat($("#unit_price").html());
	var item = $('#input_quantity');
	var orig = Number(item.val());
    var bizhong=$(".bizhong").html();
    var n=orig + 1;
	item.val(n);
	item.keyup();
   // var str='<span class="bizhong" style="color:red;">'+bizhong+'</span><font color="red"> '+price+'</font> x '+n+' = <span class="bizhong" style="color:red;">'+bizhong+'</span> <font color="red">'+(price * n).toFixed(2)+'</font>';
    //$('#items_total').html(str);
};

//详细页面商品数量 直接填写
function input_quantity(obj){

    var bizhong=$(".bizhong").html();
	var shur_num   = parseInt($(obj).val());
	var uprice     = parseFloat($("#unit_price").html());
	var upriceOrg = parseFloat($("#unit_price").attr("orgp"));

	if(isNaN(shur_num))shur_num=1;

    var accessory_price=0;
    var accessory_price1=0;
    var select_accessory_price=0;
    //复选框配件
    $("#para_accessory").find("input:checked").each(function(){
     accessory_price=$(this).attr("val");
     accessory_price=parseInt((parseFloat(accessory_price)*100).toFixed(2));
     accessory_price1=accessory_price1+accessory_price;
    });
    //accessory_price1=parseFloat(accessory_price1);
    //下拉配件
    select_accessory_price=$("#accessory_select").find("option:selected").attr("subprice");
    select_accessory_price=parseInt((parseFloat(select_accessory_price)*100).toFixed(2));
	//

	if (shur_num <= 9999){
		$(".plnum").each(function(){
			//

			cur_num = $(this).html();
			//alert(cur_num);
			cur_num = parseInt(cur_num.replace(/[\u4e00-\u9fa5]/g,""));

			if (shur_num >= cur_num ){
				//alert(promote_price);
				if(promote_price>0){
					uprice=promote_price*100;//alert(uprice);
					
				}else{
					pk     = parseFloat($(this).attr('atrp'));
					uprice = $("#pk"+pk).html();
					upriceOrg = $("#pk"+pk).attr("orgp");
                	uprice=parseInt((parseFloat(uprice)*100).toFixed(2));//alert(uprice);
				}

				if(accessory_price1||select_accessory_price){
                   uprice=((uprice+accessory_price1+select_accessory_price)/100).toFixed(2);
                }else{
                   uprice=(uprice/100).toFixed(2);
				}


				$("#unit_price").html(uprice); //附值新一级数量价格
                $("#unit_price").attr('orgp',upriceOrg);//附值新一级数量价格
			}
		});
		
		$("#input_quantity").val(shur_num);
		//$("#span_quantity").html(shur_num);
		//$("#total_sub_price").html((shur_num*uprice).toFixed(2));
		$(".add_cart_button").attr('num',shur_num);
		amt=(((upriceOrg *100)* shur_num)/100).toFixed(2);
		$('.total_price').attr('orgp',amt);
		$('.total_price').html(amt);
        var str='<span class="bizhong" style="color:red;">'+bizhong+'</span><font color="red" class="my_shop_price" orgp="'+upriceOrg+'"> </font> x '+shur_num+' = <span class="bizhong" style="color:red;">'+bizhong+'</span> <font color="red" class="my_shop_price" orgp='+amt+'></font>';
        $('#items_total').html(str);
		
		change_houbi_curr($.cookie("bizhong"));
	}
	addPeijianPrice();
};


/**
 * 增加配件价格
 *
 * @return {void} 无返回值
 */
function addPeijianPrice() {
	///alert(11);
    var el = $('#ul-peijian');

    if (el.length > 0) {//存在配件
        var elPrice = $('.total_price');
		//alert(elPrice.attr('orgp'));
        var orgp = parseFloat(elPrice.attr('orgp'));
        var price = parseFloat($(elPrice[0]).text());
        var num = parseInt($('#input_quantity').val());
        var peijian_price = 0;
        var peijian_shop_price = 0;
        var _el = $('#span-market_price');

        if (_el.length) {//市场价
            var total_price = parseFloat($('#span-market_price').text());
            var total_orgp = _el.attr('orgp');
        }
        else {

            _el = $('#unit_price');//第一个阶梯价
            var total_price = _el.length ? parseFloat(_el.text()) : 0;
            var total_orgp = _el.length ? _el.attr('orgp') : 0;
        }
        total_price =0;
		total_orgp  =0;
        el.find(':checked').each(function() {
            _el = $(this).nextAll('.my_shop_price');
            orgp += parseFloat(_el.attr('orgp')) * num;
            var _price = parseFloat(_el.text());
            peijian_price += _price;

            var _shop_price = $(this).parent().prev().find('.my_shop_price');//配件销售价
             //total_price += _shop_price.length > 0 ? parseFloat(_shop_price.text()) : _price;
			 total_price += _shop_price.length > 0 ? parseFloat(_shop_price.text()) : _price;
        });
		//alert(peijian_price * num);

        peijian_price = (peijian_price * num).toFixed(2);

		//alert(peijian_price);
		//alert(total_price);
        var total_shop_price = (price + parseFloat(peijian_price)).toFixed(2);
        var saving = (total_price * num - parseFloat(total_shop_price)).toFixed(2);
		saving = total_price * num  -peijian_price;
		//alert(saving);
        elPrice.attr('orgp', orgp).text(total_shop_price);
        $('.total_peijian_price').text(peijian_price);
        $('.total_saving').text(saving.toFixed(2));



    }
}

function checkorder(){
	 ymPrompt.setDefaultCfg({okTxt:' OK ',cancelTxt:' Cancel ',closeTxt:'Close',minTxt:'Minimize',maxTxt:'Maximize'});
	 ymPrompt.confirmInfo({icoCls:'',msgCls:'confirm',message:js_func_checkorder_0+"<br><input type='text' id='myInput' onfocus='this.select()' />",title:js_func_checkorder_1,height:150,handler:getInput,autoClose:false});
};


function getInput(tp){
	if(tp!='ok') return ymPrompt.close();
	var v=$('#myInput').val();
	if(v=='' || v.length < 17 || v.length > 18)
		alert(js_func_getInput_0);
	else{
		window.open(DOMAIN_USER+'/'+js_cur_lang_url + 'm-users-a-queryorder-n-'+v+'.htm');
		ymPrompt.close();
	}
};




function aiqi(s){
   $("#mianji").attr("mianji",s);
};


function tj(obj,goods_id){
	var local_url = $(obj).attr('href');
	if (goods_id != ''){
		$.ajax({type: "GET",url: '/tj.php?goods_id='+goods_id});
	}
	window.location.href = local_url;
}

String.prototype.ltrim = function() {
    return this.replace(/^\s+/, '');
};
String.prototype.rtrim = function() {
    return this.replace(/\s+$/, '');
};
String.prototype.trim = function() {
    return this.ltrim().rtrim();
};

/**
 * 全选，全不选
 *
 * @author      mashanling<msl-138@163.com>
 * @date        2013-02-25 10:43:17
 *
 * @param {object} cb  checkbox
 * @param {string} cls class
 *
 * @return {void} 无返回值
 */
function checkAll(cb, cls) {
    cls = cls || 'checkbox';
    $('input.' + cls).attr('checked', cb.checked);
}

/**
 * 获取选中内容
 *
 * @author      mashanling<msl-138@163.com>
 * @date        2013-02-25 10:43:17
 *
 * @param {string} cls class
 * @param {bool} noCheckedMsg 未有选择提示语。默认Please selected
 *
 * @return {string} 选中内容
 */
function getCheckedAll(cls, noCheckedMsg) {
    cls = cls || 'checkbox';
    var values = $('input.' + cls + ':checked').map(function() {
        return $(this).val();
    }).get().join(',');

    if (!values && false !== noCheckedMsg) {
        alert(noCheckedMsg || please_select);
    }

    return values;
}

//记录用户评论好评差评数
function review_helpful_num(review_id,help_type)
{
	$.ajax({
	    type: "GET",
	    url: "/index.php?m=review&a=review_helpful_num&review_id="+review_id+"&help_type="+help_type,
	    success: function(msg){
	    	if(msg == 'no_login')
	    	{
	    		var ref_url = $("#hidden-goodsUrl").val();
	    		window.location.href = DOMAIN_USER + "/log-in/?ref="+ref_url+"&Anchor=review_helpful_div_"+review_id;
	    	}
	    	else if(msg >0)
	    	{
		        if(help_type == 0)
		        {
		        	var c_id = "#review_helpful_yes_"+review_id;
		        }
		        else
		        {
		        	var c_id = "#review_helpful_no_"+review_id;
		        }
		        $(c_id).html('('+msg+')');
	        }
	        else if(msg < 0)
	        {
	        	alert('You\'ve told us.');
	        }
	    }
	});
}

//根据语言改变货币种类
function change_houbi_curr(curr){
	var bizhongList  = $(".js_bizhongList").find("li");
	var currencyBox = $("#js_currency");
	
	bizhongList.each(function(){
		var that = $(this);
		if(that.data("bizhong")==curr){
			currencyBox.html(that.html());
		}
	});
	
	$.cookie('bizhong',curr, {expires: 7, path: '/', domain: COOKIESDIAMON});
	
	$(".bizhong").html(curr);
	$(".my_shop_price").each(function(i,o){
		yuanshi = $(this).attr('orgp');
		$(o).html((parseFloat(my_array[curr]) * parseFloat(yuanshi)).toFixed(2)); 
	});
};
//选择最便宜的运费
function chooseCheapest(){
	$(".shiping_option").each(function(){
		var this_shipping_id=parseFloat($(this).attr('shipping_id'));
		var this_shipping_fee = parseFloat($(this).attr('orgp'));
		var shipping_cost = $('#shipping_sub_total').attr('orgp');
		var disabledFlag = typeof $('#shipping'+this_shipping_id).attr("disabled")=='undefined'?true:false;
		if(shipping_cost >= this_shipping_fee && disabledFlag){ 
			$('#shipping_sub_total').html(this_shipping_fee);
			$('#shipping_sub_total').attr('orgp',this_shipping_fee.toFixed(2));
			$('#shipping'+this_shipping_id).trigger("click");
			shipping_cost = this_shipping_fee;
			$('#Need_Traking_number_button'+this_shipping_id).show();
		}
	});
}

//替换特殊字符
function title2url(title, separator) {
    var pattern = /([0-9a-z\.]+)/ig;
    var match, result = [];
    
    while ((match = pattern.exec(title)) !== null) {
        result.push(match[1]);
    }

    return result.join(separator || '-').replace(/\.+/g, '.');
}