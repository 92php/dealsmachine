$(function(){

	//show more
	function setShowBtn(){
		var $categoryList = $('.categoryList'),
			categoryListSize = $categoryList.size();
		for(var i = 0; i < categoryListSize; i++){
			var $categoryListEq = $categoryList.eq(i),
				$categoryListEqLi = $categoryListEq.find('li'),
				categoryListEqW = $categoryListEq.width(),
				categoryListEqLiW = $categoryListEqLi.eq(0).width(),
				floorNum = Math.floor(categoryListEqW/categoryListEqLiW);
			if (floorNum >= $categoryListEqLi.length){
				$categoryListEq.next().hide();
			} else {
				$categoryListEq.next().show();
			}
		}
	}
	setShowBtn();
	$(window).resize(function(){
		setShowBtn();
	});
	$(".seeOperate").click(function() {
		var $categoryList = $(this).parent().find(".categoryList");
		var $this = $(this);
		if($this.data("more")==1){
			$categoryList.css("height",$categoryList.find('li').eq(0).outerHeight());
			$this.data('more', '0')
				 .find('.more').show()
				 .siblings().hide();
		}else{
			$categoryList.css("height","auto");
			$this.data('more', '1')
				 .find('.more').hide()
				 .siblings().show();
		}
	});
	
	//lick
	$('.js_licks').click(function(){
		var $this = $(this);
		if ($this.data('click') != 'active') {
			var	goodsid = $this.data('deals_id'),
				url = '/daily-deals/?act=add_up&deals_id=' + goodsid;
			//检查登录状态
			$.getJSON(DOMAIN_USER+'/fun/index.php?act=chk_sign&jsoncallback=?', function(data) {
				if (data.ms) {//登录了
					$.get(url, function(data){
						if(data == 'ok') {
							if($this.find('.clicklickicon').length == 0){
								var lickcount =  parseInt($this.text()) + 1;
								$this.find('.lickcount').text(lickcount);
								$this.find('.icon_deals').addClass('clicklickicon');
							}
						} else {
							//alert(data);
						}
					});
				} else {//没有登录去登录页面
					window.location.href="/m-users-a-sign.html?deals_id="+ goodsid;
				}
			});
		}
		
	});
	
	
	
	
});